<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>気持ち・やる気・ストレスの秘密を知る脳内診断</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="manifest" href="manifest.json" />
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
    }
  </script>
  <style>
    body {
      background: linear-gradient(135deg, #e0f7e9 0%, #a8e6cf 100%);
      min-height: 100vh;
      font-size: 1rem;
    }
    .step-section, #resultSection { display: none; }
    .active, #resultSection.active { display: block; }
    h1 { font-size: 2rem; color: #004d40; }
    h2 { font-size: 1.5rem; color: #004d40; }
    p  { font-size: 1rem; color: #004d40; }
    .form-radio { height: 1.25rem; width: 1.25rem; }
  </style>
</head>
<body class="flex flex-col items-center py-6">

  <h1 class="text-4xl font-bold mb-6 text-center">気持ち・やる気・ストレスの秘密を知る脳内診断</h1>

  <!-- 質問フォーム -->
  <div id="quizContainer" class="w-full max-w-3xl">
    <form id="quizForm" class="bg-white bg-opacity-90 p-6 rounded-lg shadow-lg space-y-8">

      <!-- ステップ1 -->
      <section id="step1" class="step-section active">
        <h2 class="font-semibold mb-4">【セロトニン関連】</h2>
        <div id="serotonin-questions"></div>
        <div class="flex justify-end">
          <button type="button" onclick="nextStep()" class="bg-blue-400 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-transform transform hover:scale-105">次へ</button>
        </div>
      </section>

      <!-- ステップ2 -->
      <section id="step2" class="step-section">
        <h2 class="font-semibold mb-4">【ドーパミン関連】</h2>
        <div id="dopamine-questions"></div>
        <div class="flex justify-between">
          <button type="button" onclick="prevStep()" class="bg-gray-300 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg transition-transform transform hover:scale-105">戻る</button>
          <button type="button" onclick="nextStep()" class="bg-green-400 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg transition-transform transform hover:scale-105">次へ</button>
        </div>
      </section>

      <!-- ステップ3 -->
      <section id="step3" class="step-section">
        <h2 class="font-semibold mb-4">【ノルアドレナリン関連】</h2>
        <div id="norepinephrine-questions"></div>
        <div class="flex justify-between">
          <button type="button" onclick="prevStep()" class="bg-gray-300 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg transition-transform transform hover:scale-105">戻る</button>
          <button type="button" onclick="showResults()" class="bg-red-400 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg transition-transform transform hover:scale-105">診断する</button>
        </div>
      </section>

    </form>
  </div>

  <!-- 結果セクション -->
  <div id="resultSection" class="bg-white bg-opacity-90 p-6 rounded-lg shadow-lg w-full max-w-3xl mt-6 text-gray-800">
    <h2 class="text-2xl font-bold mb-4 text-center">診断結果</h2>
    <div id="scoreDisplay" class="mb-4 text-lg text-center"></div>
    <div id="commentDisplay" class="mb-6 text-base text-gray-700 whitespace-pre-line"></div>
    <canvas id="radarChart" class="mb-6"></canvas>
    <div class="flex justify-center space-x-4">
      <a id="shareTwitter" target="_blank" class="bg-blue-400 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">Xでシェア</a>
      <a id="shareInstagram" target="_blank" class="bg-pink-400 hover:bg-pink-600 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">Instagram案内</a>
    </div>
  </div>
<script>
  let currentStep = 1;
  const totalSteps = 3;

  // 質問内容
  const serotoninQuestions = [
    "最近、憂うつな気分が続くことが多いですか？",
    "漠然とした不安や心配を頻繁に感じますか？",
    "寝付きが悪かったり、途中で目が覚めることが多いですか？",
    "小さなことでイライラしたり、衝動的に怒ることがありますか？",
    "人間関係にストレスを感じることが多いですか？",
    "ささいなことで落ち込むことが増えましたか？",
    "日中に眠気や倦怠感を感じやすいですか？",
    "リラックスできる時間が少ないと感じますか？"
  ];

  const dopamineQuestions = [
    "以前楽しかったことが、最近は楽しめなくなりましたか？",
    "何かを始める意欲が湧かず、やる気が出ないことが多いですか？",
    "集中が続かず、すぐに気が散ってしまうことが多いですか？",
    "ストレスを感じると衝動的な買い物やギャンブルをしてしまうことがありますか？",
    "目標を達成したときに達成感を感じにくくなりましたか？",
    "何をしても満足感が得られないことが多いですか？",
    "好きなことへの興味が薄れてきたと感じますか？",
    "モチベーションの波が激しいと感じますか？"
  ];

  const norepinephrineQuestions = [
    "最近、疲れやすく、身体がだるいと感じることが多いですか？",
    "突然の音や出来事に過剰に驚いたり、不安を感じやすいですか？",
    "夜になると頭が冴えて眠れないことが増えましたか？",
    "ストレスを感じると心臓がドキドキしたり、動悸を感じやすいですか？",
    "何かに取り組む前に過剰に緊張してしまいますか？",
    "忙しいときほど焦燥感を感じやすいですか？",
    "イライラしやすく怒りっぽくなることがありますか？",
    "強い不安で体調を崩した経験がありますか？"
  ];

  function createQuestions(questions, containerId, category) {
    const container = document.getElementById(containerId);
    questions.forEach((q, idx) => {
      const div = document.createElement("div");
      div.className = "mb-4";
      div.innerHTML = `
        <p class="mb-2">${idx + 1}. ${q}</p>
        <div class="flex items-center space-x-2">
          ${[0,1,2,3,4,5].map(num => `
            <label class="inline-flex items-center space-x-1">
              <input type="radio" name="${category}_${idx+1}" value="${num}" class="form-radio">
              <span>${num}</span>
            </label>
          `).join('')}
        </div>
      `;
      container.appendChild(div);
    });
  }

  function showStep(n) {
    for (let i = 1; i <= totalSteps; i++) {
      document.getElementById(`step${i}`).classList.toggle('active', i === n);
    }
  }

  function nextStep() {
    if (currentStep < totalSteps) {
      currentStep++;
      showStep(currentStep);
    }
  }

  function prevStep() {
    if (currentStep > 1) {
      currentStep--;
      showStep(currentStep);
    }
  }

  function showResults() {
    // バリデーション
    for (let cat of ['serotonin', 'dopamine', 'norepinephrine']) {
      for (let i = 1; i <= 8; i++) {
        if (!document.querySelector(`input[name="${cat}_${i}"]:checked`)) {
          alert('未回答の設問があります。すべて選択してください。');
          return;
        }
      }
    }

    let serotonin = 0, dopamine = 0, norepinephrine = 0;
    for (let i = 1; i <= 8; i++) {
      serotonin      += parseInt(document.querySelector(`input[name="serotonin_${i}"]:checked`).value);
      dopamine       += parseInt(document.querySelector(`input[name="dopamine_${i}"]:checked`).value);
      norepinephrine += parseInt(document.querySelector(`input[name="norepinephrine_${i}"]:checked`).value);
    }

    document.getElementById('quizContainer').style.display = 'none';
    const res = document.getElementById('resultSection');
    res.classList.add('active');

    document.getElementById('scoreDisplay').innerText =
      `セロトニン: ${serotonin}　ドーパミン: ${dopamine}　ノルアドレナリン: ${norepinephrine}`;

    const comments = [];

    if (serotonin < 16) {
      comments.push("● セロトニンが低めです：気分の安定が低下傾向にあります。\n→【改善アクション】深呼吸や短い瞑想を1日5分取り入れてみましょう。");
    } else if (serotonin > 24) {
      comments.push("● セロトニンは良好です：ストレス耐性があります。\n→【改善アクション】散歩など軽い運動を継続して、好調を維持しましょう。");
    } else {
      comments.push("● セロトニンは平均的です：バランスが取れています。\n→【改善アクション】就寝前のリラックスタイムを確保して、安定感を維持しましょう。");
    }

    if (dopamine < 16) {
      comments.push("● ドーパミンが低めです：やる気や快楽感が不足しがちです。\n→【改善アクション】5分で終わる小さなタスクを設定して、達成感を積み重ねましょう。");
    } else if (dopamine > 24) {
      comments.push("● ドーパミンは良好です：モチベーションが高い状態です。\n→【改善アクション】長めのプロジェクトに着手して、集中力を活かしましょう。");
    } else {
      comments.push("● ドーパミンは平均的です：ほどよい意欲があります。\n→【改善アクション】新しい趣味や学びに少しずつ挑戦してみてください。");
    }

    if (norepinephrine < 16) {
      comments.push("● ノルアドレナリンが低めです：疲れやすさを感じやすいです。\n→【改善アクション】朝日を浴びながらストレッチをして、覚醒度を上げましょう。");
    } else if (norepinephrine > 24) {
      comments.push("● ノルアドレナリンは高めです：過緊張や不安感が強いかもしれません。\n→【改善アクション】1日に数回、軽い深呼吸や短い休憩を意識して取り入れましょう。");
    } else {
      comments.push("● ノルアドレナリンは平均的です：適度な覚醒があります。\n→【改善アクション】タイマーを使い、メリハリのある作業サイクルを保ちましょう。");
    }

    document.getElementById('commentDisplay').innerText = comments.join("\n\n");

    const ctx = document.getElementById('radarChart').getContext('2d');
    new Chart(ctx, {
      type: 'radar',
      data: {
        labels: ['セロトニン','ドーパミン','ノルアドレナリン'],
        datasets: [{
          label: '脳内物質バランス',
          data: [serotonin, dopamine, norepinephrine],
          fill: true,
          backgroundColor: 'rgba(34,197,94,0.2)',
          borderColor: 'rgba(34,197,94,1)',
          pointBackgroundColor: 'rgba(34,197,94,1)'
        }]
      },
      options: {
        scale: { ticks: { beginAtZero: true, max: 40 } }
      }
    });

    const shareText = encodeURIComponent(`🧠脳内診断しました！\nセロトニン:${serotonin} ドーパミン:${dopamine} ノルアドレナリン:${norepinephrine}\n#脳内バランス診断`);
    document.getElementById('shareTwitter').href = `https://twitter.com/intent/tweet?text=${shareText}`;
    document.getElementById('shareInstagram').href = `https://www.instagram.com/`;
  }

  // 初期化
  createQuestions(serotoninQuestions, 'serotonin-questions', 'serotonin');
  createQuestions(dopamineQuestions, 'dopamine-questions', 'dopamine');
  createQuestions(norepinephrineQuestions, 'norepinephrine-questions', 'norepinephrine');
  showStep(currentStep);
</script>

</body>
</html>
